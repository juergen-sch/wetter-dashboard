<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Weather-Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  :root{
    --bg:#f0f0f0;
    --card:#ffffff;
    --muted:#667085;
    --text:#1f2937;
    --line:rgba(0,0,0,0.10);
    --shadow:0 2px 12px rgba(0,0,0,0.06);
    --radius:14px;
    --accent:#007BFF;
  }

  body { font-family: Arial, sans-serif; background: var(--bg); margin: 0; padding: 0; color: var(--text); }
  .container { width: 95%; max-width: 1300px; margin: 20px auto; background: var(--card); padding: 18px; box-shadow: var(--shadow); border-radius: var(--radius); }
  h1, h2, h3, h4 { color: #111827; margin-top: 1em; }
  a{ color: inherit; }
  select, button { padding: 6px 12px; font-size: 16px; margin: 10px 5px 20px 0; }

  /* ===== Header ===== */
  .header{
    display:flex;
    gap: 14px;
    align-items:center;
    justify-content:space-between;
    flex-wrap:wrap;
    margin-bottom: 12px;
  }
  .header h1{
    margin:0;
    font-size: 22px;
    letter-spacing: .2px;
  }
  .header .timebox{
    text-align:right;
    color:#555;
    line-height:1.25;
    min-width: 250px;
  }
  .header .timebox #datetime{ font-size: 1rem; }
  .header .timebox .subline{ font-size:0.92rem; opacity:.92; }

  /* ===== Main Tabs ===== */
  .main-tabs{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
    border-bottom: 1px solid var(--line);
    padding-bottom: 10px;
    margin-bottom: 14px;
  }
  .main-tab-btn{
    padding: 9px 14px;
    border-radius: 999px;
    background: rgba(0,0,0,0.04);
    border: 1px solid rgba(0,0,0,0.08);
    cursor: pointer;
    margin: 0;
    font-size: 14px;
  }
  .main-tab-btn.active{
    background: var(--accent);
    color: #fff;
    border-color: rgba(0,0,0,0.0);
  }
  .main-section{ display:none; }
  .main-section.active{ display:block; }

  /* ===== Cards / Layout ===== */
  .card{
    background: var(--card);
    border: 1px solid var(--line);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: 14px;
  }
  .grid-landing{
    display:grid;
    grid-template-columns: 1fr 390px;
    gap: 16px;
    align-items:start;
  }
  .grid-landing > div{ min-width:0; }

  .right-stack{ display:flex; flex-direction:column; gap:16px; align-items:stretch; }
  .weekly{ min-width:0; }
  .forecast{ min-width:0; }

  .wx-quick{
    display:grid;
    gap: 14px;
  }

  /* ===== Top controls (Suche) ===== */
  .top-controls{
    display:flex;
    gap:12px;
    flex-wrap:wrap;
    align-items:flex-end;
    margin-top: 10px;
  }
  .top-controls .block{
    display:flex;
    flex-direction:column;
    gap:6px;
    flex: 1 1 420px;
    min-width: 260px;
  }
  .top-controls label{ margin: 0; font-size: 14px; color:#333; }
  .top-controls button, .top-controls input{ margin: 0; font-size: 16px; }
  .top-controls .searchrow{ display:flex; gap:8px; align-items:center; }
  .top-controls input{
    flex:1; padding: 6px 10px; border: 1px solid rgba(0,0,0,0.18);
    border-radius: 12px; outline: none;
  }
  .top-controls input:focus{
    border-color: rgba(0,123,255,0.5);
    box-shadow: 0 0 0 3px rgba(0,123,255,0.12);
  }
  .top-controls button{
    padding: 7px 12px; border: 1px solid rgba(0,0,0,0.18);
    background: rgba(255,255,255,0.9); border-radius: 12px; cursor:pointer;
  }
  .top-controls button:hover{ filter: brightness(0.98); }
  #placeStatus{ font-size:12px; color:#666; min-height: 16px; }

  /* ===== Forecast layout ===== */
  .forecast { display:block; }
  .weekly { display:flex; overflow-x:auto; gap:10px; padding-bottom:10px; max-width:100%; }
  .weekly::-webkit-scrollbar{ height:10px; }
  .weekly::-webkit-scrollbar-thumb{ background: rgba(0,0,0,0.25); border-radius:999px; }
  .weekly::-webkit-scrollbar-track{ background: rgba(0,0,0,0.08); border-radius:999px; }

  .forecast-card, .day-card {
    flex: 0 0 auto; background: #f8f8f8; padding: 10px; border-radius: 12px;
    text-align: center; box-shadow: 0 1px 4px rgba(0,0,0,0.08); width: 120px;
    border: 1px solid rgba(0,0,0,0.06);
  }
  .forecast-card.night { background-color: #dde3ea; }
  .forecast-card.evening { background-color: #f0e0d0; }
  .temp-warm { color: darkred; font-weight: bold; }
  .temp-cool { color: steelblue; font-weight: bold; }

  .buttons{ margin-top: 10px; }
  .buttons button{
    border: 1px solid rgba(0,0,0,0.18);
    background: rgba(255,255,255,0.9);
    border-radius: 12px;
    cursor:pointer;
    margin: 0 8px 10px 0;
  }
  .buttons button.button-active { background: var(--accent); color: white; border-color: rgba(0,0,0,0.0); }

  canvas { background: #fff; border-radius: 12px; box-shadow: 0 1px 4px rgba(0,0,0,0.08); }

  /* ===== Chart Tabs (nur f√ºr Charts) ===== */
  .chart-tabs { display: flex; margin-bottom: 10px; gap: 6px; flex-wrap:wrap; }
  .chart-tab-button {
    padding: 10px 14px; background: #eee; cursor: pointer; border-radius: 12px;
    border: 1px solid rgba(0,0,0,0.08);
    user-select:none;
  }
  .chart-tab-button.active { background: var(--accent); color: white; border-color: rgba(0,0,0,0.0); }
  .chart-tab-content { display: none; }
  .chart-tab-content.active { display: block; }

  /* ===== Startseite Embed box ===== */
  .embed-box{
    width: 390px;
    max-width: 100%;
    background: #fff;
    border-radius: var(--radius);
    border: 1px solid rgba(0,0,0,0.08);
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    padding: 12px;
  }
  .embed-box .embed-title{
    font-size: 14px;
    font-weight: 700;
    color:#333;
    margin: 2px 0 10px 0;
  }
  .embed-box a{ margin:0 !important; }

  /* ===== CTA Button ===== */
  .cta-row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top: 6px; }
  .cta{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding: 10px 14px;
    border-radius: 999px;
    background: var(--accent);
    color: #fff;
    border: 0;
    text-decoration:none;
    font-weight: 700;
    box-shadow: 0 6px 16px rgba(0,123,255,0.18);
  }
  .cta.secondary{
    background: rgba(0,0,0,0.06);
    color: #111827;
    box-shadow:none;
    border: 1px solid rgba(0,0,0,0.10);
    font-weight: 600;
  }

  /* ===== Webcams ===== */
  .webcams {
    display: flex; flex-wrap: wrap; gap: 20px; margin-top: 12px; justify-content: space-between;
  }
  .webcam { flex: 1 1 48%; display: flex; flex-direction: column; align-items: center; }
  .webcam img, .webcam iframe, .webcam video {
    width: 100%; height: 400px; object-fit: cover;
    border-radius: var(--radius); box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    border: 1px solid rgba(0,0,0,0.08);
    background:#fff;
  }

  /* ===== METAR/TAF PRO PANEL (unver√§ndert, nur leicht an Variablen angepasst) ===== */
  .wx-panel {
    margin-top: 10px;
    padding: 14px;
    border-radius: 14px;
    background: linear-gradient(180deg, #fbfbfd, #f4f6fa);
    border: 1px solid rgba(0,0,0,0.08);
    box-shadow: 0 8px 22px rgba(0,0,0,0.06);
  }
  .wx-panel.cat-vfr  { border-color: rgba(16,185,129,.28); }
  .wx-panel.cat-mvfr { border-color: rgba(245,158,11,.30); }
  .wx-panel.cat-ifr  { border-color: rgba(239,68,68,.28); }
  .wx-panel.cat-lifr { border-color: rgba(147,51,234,.28); }

  .wx-topline {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 10px;
    justify-content: space-between;
    margin-bottom: 10px;
  }
  .wx-title { display:flex; align-items:center; gap:10px; margin:0; }
  .wx-badges { display:flex; flex-wrap:wrap; gap:8px; align-items:center; }

  .wx-pill {
    display:inline-flex;
    align-items:center;
    gap:6px;
    padding: 4px 10px;
    border-radius: 999px;
    font-size: 12px;
    border: 1px solid rgba(0,0,0,0.10);
    background: rgba(255,255,255,0.75);
  }
  .wx-pill strong { font-weight: 700; }
  .wx-pill.vfr  { border-color: rgba(16, 185, 129, .35); }
  .wx-pill.mvfr { border-color: rgba(245, 158, 11, .45); }
  .wx-pill.ifr  { border-color: rgba(239, 68, 68, .40); }
  .wx-pill.lifr { border-color: rgba(147, 51, 234, .35); }

  .wx-grid { display:grid; grid-template-columns: 1.1fr 0.9fr; gap: 12px; }

  .wx-card {
    border-radius: 14px;
    background: rgba(255,255,255,0.85);
    border: 1px solid rgba(0,0,0,0.08);
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    padding: 12px;
  }

  .wx-card h4 {
    margin: 0 0 10px 0;
    display:flex;
    justify-content:space-between;
    align-items:center;
    font-size: 14px;
  }

  .wx-kv {
    display:grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 8px 12px;
    margin-bottom: 10px;
  }

  .wx-kv .item {
    padding: 8px 10px;
    border-radius: 12px;
    background: rgba(0,0,0,0.03);
    border: 1px solid rgba(0,0,0,0.06);
    transition: border-color .15s ease, background .15s ease;
  }
  .wx-kv .label { font-size: 12px; opacity: .75; }
  .wx-kv .value { font-size: 14px; font-weight: 700; margin-top: 3px; }

  .wx-kv .item.warn { border-color: rgba(245,158,11,.35); background: rgba(245,158,11,.08); }
  .wx-kv .item.crit { border-color: rgba(239,68,68,.38); background: rgba(239,68,68,.08); }

  .wx-raw {
    background: rgba(0,0,0,0.03);
    border: 1px dashed rgba(0,0,0,0.15);
    padding: 10px;
    border-radius: 12px;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    font-size: 13px;
    white-space: pre-wrap;
    margin: 0;
  }

  .wx-actions { display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; }

  .wx-btn {
    border: 1px solid rgba(0,0,0,0.15);
    background: rgba(255,255,255,0.85);
    padding: 7px 10px;
    border-radius: 10px;
    cursor: pointer;
    font-size: 13px;
    margin: 0;
  }
  .wx-btn:hover { filter: brightness(0.98); }

  .wx-subtle { font-size: 12px; opacity: .75; margin-top: 8px; }

  @media (max-width: 900px) {
    .wx-grid { grid-template-columns: 1fr; }
    .wx-kv { grid-template-columns: 1fr 1fr; }
    .grid-landing{ grid-template-columns: 1fr; }
    .embed-box{ width: 100%; }
  }

  @media (max-width: 768px) {
    .webcams { flex-direction: column; }
    .webcam { flex: 1 1 100%; }
    .forecast-card, .day-card { width: 100px; }
    canvas { width: 100% !important; height: auto !important; }
    .chart-tabs { flex-wrap: wrap; }
    .chart-tab-button { flex: 1 1 100%; }
    .buttons button { width: 100%; margin-bottom: 10px; }
    .header .timebox{ text-align:left; }
  }

.embed-box{
  max-width:100%;
  overflow:hidden;
}
.embed-box iframe,
.embed-box a{
  max-width:100% !important;
}


  /* metar-taf widget containment (keine Code-√Ñnderung am Embed selbst) */
  .metar-embed-wrap{
    width: 350px;
    max-width: 100%;
    overflow: hidden;
  }
  @media (max-width: 420px){
    .metar-embed-wrap{
      width: 350px;
      transform-origin: top left;
      transform: scale(calc((100vw - 48px) / 350));
    }
  }

</style>
</head>

<body>
<div class="container">

  <!-- ===== Header ===== -->
  <div class="header">
    <h1>Weather-Dashboard</h1>
    <div class="timebox">
      <div id="datetime"></div>
      <div class="subline">
        UTC: <strong id="utcNow">--:--:--</strong> ¬∑
        LOLU SR: <strong id="loluSunrise">--:--</strong> ¬∑
        SS: <strong id="loluSunset">--:--</strong>
      </div>
    </div>
  </div>

  <!-- ===== Main Navigation ===== -->
  <div class="main-tabs" role="tablist" aria-label="Navigation">
    <button class="main-tab-btn active" id="mainBtnLanding" type="button" onclick="switchMainTab('landing')">üè† Startseite</button>
    <button class="main-tab-btn" id="mainBtnWetter" type="button" onclick="switchMainTab('wetter')">üå¶Ô∏è Wetter</button>
    <button class="main-tab-btn" id="mainBtnWebcams" type="button" onclick="switchMainTab('webcams')">üì∑ Webcams</button>
    <button class="main-tab-btn" id="mainBtnTools" type="button" onclick="switchMainTab('tools')">‚úàÔ∏è Pilotentools</button>
  </div>

  <!-- =========================
       STARTSEITE (Default)
       ========================= -->
  <section id="section-landing" class="main-section active">
    <div class="grid-landing">
      <div class="wx-quick">

        <div class="card">
          <h2 style="margin-top:0;">Aktuelles Wetter ‚Äì Gmunden</h2>
          <p id="landing-current-weather">Lade Daten...</p>

          <div class="cta-row">
            <a class="cta" href="https://onres24.com/login.php" target="_blank" rel="noopener">üìÖ ONRES √∂ffnen</a>
            <button class="cta secondary" type="button" onclick="switchMainTab('wetter')">‚û° Details im Wetter-Tab</button>
          </div>
        </div>

        <div class="card forecast">
          <h2 style="margin-top:0;">12-Stunden-Vorhersage ‚Äì Flugplatz Gmunden</h2>
          <div class="weekly" id="landing-forecast" style="max-width:100%; overflow-x:auto; overflow-y:hidden;"></div>
        </div>

        <div class="card">
          <h2 style="margin-top:0;">Webcams Flugplatz Gmunden</h2>
          <div class="webcams">
            <div class="webcam">
              <h3>Gmunden S√ºd-West</h3>
              <img alt="Webcam SW" src="https://www.fliegerclub-traunsee.at/cams/image-west000M.jpg"/>
            </div>
            <div class="webcam">
              <h3>Gmunden Osten</h3>
              <img alt="Webcam Ost" src="https://www.fliegerclub-traunsee.at/cams/image-ost000.jpg"/>
            </div>
          </div>
        </div>

      </div>

      <div class="right-stack">
        <div class="embed-box">
          <div class="embed-title">METAR/TAF Widget (LOLU/LOWL)</div>
          
<a href="https://metar-taf.com/metar/LOLU?station_id=LOWL" id="metartaf-YNwIGHbL" style="font-size:18px; font-weight:500; color:#000; width:350px; height:278px; display:block">METAR Gmunden-Laakirchen Airfield</a>
<script async defer crossorigin="anonymous" src="https://metar-taf.com/embed-js/LOLU?u=68055&station_id=LOWL&layout=landscape&qnh=hPa&rh=rh&target=YNwIGHbL"></script>

        </div>

        <div class="card" style="padding:12px;">
          <h2 style="margin:0 0 10px 0;">SafeSky Live</h2>
          <iframe
            src="https://live.safesky.app/map?lat=47.96899&lng=13.72095&zoom=8.50"
            width="100%" height="520"
            style="border:0; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.10);"
            loading="lazy"
            referrerpolicy="no-referrer"
            allowfullscreen>
          </iframe>
        </div>
      </div>

    </div>
  </section>

  <!-- =========================
       WETTER (Detail)
       ========================= -->
  <section id="section-wetter" class="main-section">
    <div class="card">
      <h2 style="margin-top:0;">Ort suchen</h2>
      <div class="top-controls">
        <div class="block">
          <label for="customPlace">Ort suchen (Standard ist Gmunden):</label>
          <div class="searchrow">
            <input id="customPlace" type="text" placeholder="z. B. Traunkirchen, Wien, LOWW‚Ä¶">
            <button type="button" onclick="searchPlace()">Suchen</button>
          </div>
          <div id="placeStatus"></div>
        </div>
      </div>

      <div class="buttons">
        <button class="button-active" id="btn0" onclick="setDay(0)">Heute</button>
        <button id="btn1" onclick="setDay(1)">Morgen</button>
        <button id="btn2" onclick="setDay(2)">√úbermorgen</button>
      </div>
    </div>

    <div style="height:12px;"></div>

    <div class="card">
      <h2 style="margin-top:0;">Aktuelles Wetter</h2>
      <p id="weather-current-weather">Lade Daten...</p>
    </div>
    <div style="height:12px;"></div>

    <div style="height:12px;"></div>

    <div class="card forecast">
      <h2 style="margin-top:0;">12-Stunden-Vorhersage</h2>
      <div class="weekly" id="weather-forecast"></div>
    </div>

    <h2>üîç Wetterverl√§ufe (24h)</h2>
    <div class="chart-tabs">
      <div class="chart-tab-button active" onclick="switchChartTab(0)">üå°Ô∏è Temperatur</div>
      <div class="chart-tab-button" onclick="switchChartTab(1)">üí® Wind (Knoten)</div>
      <div class="chart-tab-button" onclick="switchChartTab(2)">üåßÔ∏è Regen (mm)</div>
      <div class="chart-tab-button" onclick="switchChartTab(3)">üëÅÔ∏è Sichtweite</div>
    </div>

    <div class="chart-tab-content active"><canvas height="100" id="tempChart"></canvas></div>
    <div class="chart-tab-content"><canvas height="100" id="windChart"></canvas></div>
    <div class="chart-tab-content"><canvas height="100" id="rainChart"></canvas></div>

    <div class="card" style="margin-top:14px;">
      <h2 style="margin-top:0;">Wochen√ºbersicht</h2>
      <div class="weekly" id="weekly"></div>
    </div>

    <h2>üõ∞Ô∏è Interaktives Wetterradar (Wind, Regen &amp; Temperatur ‚Äì Windy)</h2>
    <iframe allowfullscreen="" frameborder="0" height="500"
      src="https://embed.windy.com/embed2.html?lat=47.95193816341858&amp;lon=13.865803101922268&amp;detailLat=47.95193816341858&amp;detailLon=13.865803101922268&amp;width=100%&amp;height=500&amp;zoom=10&amp;level=surface&amp;overlay=wind&amp;menu=true&amp;message=true&amp;marker=true&amp;calendar=now&amp;pressure=true&amp;type=map&amp;location=coordinates&amp;detail=true"
      style="border:0; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" width="100%"></iframe>
  </section>

  <!-- =========================
       WEBCAMS
       ========================= -->
  <section id="section-webcams" class="main-section">
    <div class="card">
      <h2 style="margin-top:0;">Webcams</h2>

      <div class="webcams"><div class="webcam">
          <h3>Gmunden S√ºd-West</h3>
          <img alt="Webcam SW" src="https://www.fliegerclub-traunsee.at/cams/image-west000M.jpg"/>
        </div>
        <div class="webcam">
          <h3>Gmunden Osten</h3>
          <img alt="Webcam Ost" src="https://www.fliegerclub-traunsee.at/cams/image-ost000.jpg"/>
        </div>
        <div class="webcam">
          <h3>Schafberg (Panomax)</h3>
          <a href="https://schafberg.panomax.com/" target="_blank" rel="noopener" style="width:100%;">
            <img id="camSchafbergImg" alt="Schafberg Livebild" src="https://images.webcamgalore.com/20508-current-webcam-St-Gilgen.jpg"/>
          </a>
          <div style="color: var(--muted); font-size: 12px; margin-top: 6px; text-align:center;">
            √ñffnet die interaktive Panomax-Ansicht in neuem Tab.
          </div>
        </div>
        <div class="webcam">
          <h3>üåÑ Panoramablick vom Lichtenberg</h3>
          <a href="https://lichtenberg.panomax.com/" target="_blank" rel="noopener" style="width:100%;">
            <img id="camLichtenbergImg" alt="Lichtenberg Livebild" src="https://images.webcamgalore.com/27390-current-webcam-Lichtenberg.jpg"/>
          </a>
          <div style="color: var(--muted); font-size: 12px; margin-top: 6px; text-align:center;">
            √ñffnet die interaktive Panomax-Ansicht in neuem Tab.
          </div>
        </div>

        <div class="webcam">
          <h3>LOLS Suben ‚Äì Richtung 32 (Blick Abflugpunkt 14)</h3>
          <a href="https://www.lols.at/webcam/" target="_blank" rel="noopener" style="width:100%;">
            <img id="camLOLS32" alt="LOLS Richtung 32" src="https://www.lols.at/wp-content/uploads/2026/02/flugfeld1.jpg"/>
          </a>
        </div>

        <div class="webcam">
          <h3>LOLS Suben ‚Äì Richtung 14 (Blick Abflugpunkt 32)</h3>
          <a href="https://www.lols.at/webcam/" target="_blank" rel="noopener" style="width:100%;">
            <img id="camLOLS14" alt="LOLS Richtung 14" src="https://www.lols.at/wp-content/uploads/2026/02/flugfeld2.jpg"/>
          </a>
        </div>

        <div class="webcam">
          <h3>Scharnstein (Almtal.Net)</h3>
          <a href="https://www.almtal.net/webcam/" target="_blank" rel="noopener" style="width:100%;">
            <img id="camScharnstein" alt="Webcam Scharnstein" src="https://www.almtal.net/cam_images/current.jpg"/>
          </a>
        </div>

        <div class="webcam">
          <h3>LOLW Wels ‚Äì Live (Apron)</h3>
          <a href="https://www.wmw.at/webcam-platzwetter/" target="_blank" rel="noopener" style="width:100%;">
            <img id="camLOLW" alt="LOLW Wels Webcam" src="https://www.wmw.at/webcam/caming.jpg"/>
          </a>
          <div style="color: var(--muted); font-size: 12px; margin-top: 6px; text-align:center;">
            Falls dein Browser das Bild nicht l√§dt: Link √∂ffnet die Webcam-Seite in neuem Tab.
          </div>
        </div>


        <div class="webcam">
          <h3>Gr√ºnberg Gmunden</h3>
          <a href="https://www.gruenberg.info/de/aktuelles/webcam-gruenberg" target="_blank" rel="noopener" style="width:100%;">
            <img id="camGruenberg"
                 alt="Gr√ºnberg Gmunden Webcam"
                 src="https://wtvthmb.feratel.com/thumbnails/5134.jpeg?t=38&dcsdesign=WTP_partner&design=v5"/>
          </a>
        </div>
    
        <div class="webcam">
          <h3>Traunstein (Foto-Webcam)</h3>
          <a href="https://www.foto-webcam.eu/webcam/traunstein/" target="_blank" rel="noopener" style="width:100%;">
            <img id="camTraunsteinFoto"
                 alt="Traunstein Foto-Webcam"
                 src="https://www.foto-webcam.eu/webcam/traunstein/current/720.jpg"/>
          </a>
        </div>
</div>
  </section>

  <!-- =========================
       PILOTENTOOLS
       ========================= -->
  <section id="section-tools" class="main-section">
    <div class="card">
      <h2 style="margin-top:0;">‚úàÔ∏è Pilotentools</h2>
      <div style="display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 10px;">
        <a class="cta secondary" href="https://www.homebriefing.com/cms-acg/opencms/de/home/" target="_blank" rel="noopener">üìù Homebriefing (ACG)</a>
        <a class="cta" href="https://onres24.com/login.php" target="_blank" rel="noopener">üìÖ ONRES (Login)</a>
        <a class="cta secondary" href="https://metar-taf.com/" target="_blank" rel="noopener">üì° METAR/TAF √úbersicht</a>
        <a class="cta secondary" href="https://eaip.austrocontrol.at/" target="_blank" rel="noopener">üìò eAIP Austria</a>
      </div>
      <div style="color: var(--muted); font-size: 13px;">Tipp: Das gro√üe METAR/TAF-Panel unten eignet sich super f√ºr schnellen VFR/IFR-Check inkl. Warnmarkierungen.</div>
    </div>

    <div class="card" style="margin-top:14px;">
      <h2 style="margin-top:0;">üì° METAR / TAF (Flugwetter √ñsterreich)</h2>
      <label for="metarSelect">Flugplatz w√§hlen:</label>
      <select id="metarSelect" style="margin-bottom: 10px;">
        <option value="LOAV">LOAV ‚Äì V√∂slau</option>
        <option value="LOWL">LOWL ‚Äì Linz</option>
        <option value="LOWW">LOWW ‚Äì Wien</option>
        <option value="LOWG">LOWG ‚Äì Graz</option>
        <option value="LOWK">LOWK ‚Äì Klagenfurt</option>
        <option value="LOWI">LOWI ‚Äì Innsbruck</option>
      </select>

      <div id="wxPanel" class="wx-panel">
        <div class="wx-topline">
          <h3 class="wx-title">üì° METAR / TAF</h3>

          <div class="wx-badges">
            <span id="wxCatPill" class="wx-pill" style="display:none;">
              <strong id="wxCatText"></strong>
            </span>
            <span class="wx-pill">Station: <strong id="wxStation">‚Äî</strong></span>
            <span class="wx-pill">Stand (UTC): <strong id="wxObs">‚Äî</strong></span>
          </div>
        </div>

        <div class="wx-grid">
          <div id="wxMetarCard" class="wx-card">
            <h4>
              <span>METAR</span>
              <div class="wx-actions">
                <button class="wx-btn" type="button" onclick="copyText('metarRaw')">Copy</button>
                <button class="wx-btn" type="button" onclick="toggleRaw('metarRaw')">Raw</button>
              </div>
            </h4>

            <div class="wx-kv">
              <div id="kvWind" class="item"><div class="label">Wind</div><div class="value" id="wxWind">‚Äî</div></div>
              <div id="kvVis" class="item"><div class="label">Sicht</div><div class="value" id="wxVis">‚Äî</div></div>
              <div id="kvCeil" class="item"><div class="label">Ceiling</div><div class="value" id="wxCeil">‚Äî</div></div>
              <div id="kvQnh" class="item"><div class="label">QNH</div><div class="value" id="wxQnh">‚Äî</div></div>
              <div id="kvTemp" class="item"><div class="label">Temp / DP</div><div class="value" id="wxTempDp">‚Äî</div></div>
              <div id="kvWx" class="item"><div class="label">Wetter</div><div class="value" id="wxWx">‚Äî</div></div>
            </div>

            <pre id="metarRaw" class="wx-raw">Lade METAR‚Ä¶</pre>
            <div id="wxHint" class="wx-subtle"></div>
          </div>

          <div class="wx-card">
            <h4>
              <span>TAF</span>
              <div class="wx-actions">
                <button class="wx-btn" type="button" onclick="copyText('tafRaw')">Copy</button>
                <button class="wx-btn" type="button" onclick="toggleRaw('tafRaw')">Raw</button>
              </div>
            </h4>

            <pre id="tafRaw" class="wx-raw">Lade TAF‚Ä¶</pre>
            <div class="wx-subtle" id="wxTafNote"></div>
          </div>
        </div>
      </div>
    </div>
  </section>

<script>
  // =========================
  // Main Tabs
  // =========================
  function switchMainTab(key){
    const map = {
      landing: "section-landing",
      wetter: "section-wetter",
      webcams: "section-webcams",
      tools: "section-tools"
    };

    document.querySelectorAll(".main-tab-btn").forEach(b => b.classList.remove("active"));
    document.querySelectorAll(".main-section").forEach(s => s.classList.remove("active"));

    if(key === "landing") document.getElementById("mainBtnLanding").classList.add("active");
    if(key === "wetter")  document.getElementById("mainBtnWetter").classList.add("active");
    if(key === "webcams") document.getElementById("mainBtnWebcams").classList.add("active");
    if(key === "tools")   document.getElementById("mainBtnTools").classList.add("active");

    const id = map[key] || map.landing;
    const el = document.getElementById(id);
    if(el) el.classList.add("active");

    // kleine UX: bei Tabwechsel nach oben scrollen
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  // =========================
  // Chart Tabs (24h)
  // =========================
  function switchChartTab(index) {
    document.querySelectorAll(".chart-tab-button").forEach((btn, i) =>
      btn.classList.toggle("active", i === index)
    );
    document.querySelectorAll(".chart-tab-content").forEach((tab, i) =>
      tab.classList.toggle("active", i === index)
    );
  }

  // =========================
  // Wetterlogik (aus deiner Datei √ºbernommen; nur IDs erweitert)
  // =========================

  // Default coords (Gmunden)
  const DEFAULT_COORDS = { lat: 47.918, lon: 13.799 };

  let selectedDay = 0;
  let tempChart, windChart, rainChart;

  function setDay(dayIndex) {
    selectedDay = dayIndex;
    document.querySelectorAll(".buttons button").forEach(btn => btn.classList.remove("button-active"));
    const b = document.getElementById("btn" + dayIndex);
    if(b) b.classList.add("button-active");

    const c = window.__customCoords || DEFAULT_COORDS;
    loadWeather(c.lat, c.lon);
  }

  function knots(kmh) { return +(kmh / 1.852).toFixed(1); }

  function windDirectionToText(degree) {
    const dirs = ['N', 'NO', 'O', 'SO', 'S', 'SW', 'W', 'NW'];
    return dirs[Math.round(degree / 45) % 8];
  }

  function setHtmlIfExists(id, html){
    const el = document.getElementById(id);
    if(el) el.innerHTML = html;
  }
  function setTextIfExists(id, txt){
    const el = document.getElementById(id);
    if(el) el.textContent = txt;
  }

  async function loadWeather(lat, lon) {
    const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&hourly=temperature_2m,windspeed_10m,winddirection_10m,precipitation&daily=temperature_2m_max,temperature_2m_min,sunrise,sunset&current_weather=true&timezone=auto`;
    const res = await fetch(url);
    const data = await res.json();

    const current = data.current_weather;
    const currentHtml = `
      üå°Ô∏è Temperatur: ${current.temperature}¬∞C<br>
      üå¨Ô∏è Wind: ${current.windspeed} km/h<br>
      üïí Letztes Update: ${current.time.replace("T", " Uhr ")}
    `;
    setHtmlIfExists("landing-current-weather", currentHtml);
    setHtmlIfExists("weather-current-weather", currentHtml);

    // 12h forecast: landing + wetter
    const forecastIds = ["landing-forecast", "weather-forecast"];
    forecastIds.forEach(id => {
      const fc = document.getElementById(id);
      if(fc) fc.innerHTML = "";
    });

    const now = new Date();
    const nowISODate = now.toISOString().slice(0,10);

    const idx = data.hourly.time.findIndex(t => {
      const d = new Date(t);
      return d.getHours() === now.getHours() && t.slice(0,10) === nowISODate;
    });

    const startIdx = idx >= 0 ? idx : 0;

    let forecastHtml = "";
    for (let i = startIdx; i < startIdx + 12 && i < data.hourly.time.length; i++) {
      const temp = data.hourly.temperature_2m[i];
      const wind = data.hourly.windspeed_10m[i];
      const dir = windDirectionToText(data.hourly.winddirection_10m[i]);
      const hour = new Date(data.hourly.time[i]).getHours();
      const time = hour.toString().padStart(2, '0') + " Uhr";
      let icon = temp >= 25 ? "‚òÄÔ∏è" : temp < 0 ? "‚ùÑÔ∏è" : hour < 7 || hour > 20 ? "üåô" : "‚õÖ";
      let timeClass = hour >= 20 || hour < 6 ? "night" : hour >= 17 ? "evening" : "";
      forecastHtml += `
        <div class="forecast-card ${timeClass}">
          <strong>${time}</strong><br>
          <div style="font-size:22px;">${icon}</div>
          <div class="${temp >= 20 ? "temp-warm" : "temp-cool"}">${temp}¬∞C</div>
          üí® ${wind} km/h<br>üß≠ ${dir}
        </div>`;
    }
    forecastIds.forEach(id => setHtmlIfExists(id, forecastHtml));

    // Charts + selected-day arrays (nur im Wetter-Tab vorhanden)
    const start = selectedDay * 24;
    const temps = [], winds = [], rains = [], labels = [];
    for (let i = start; i < start + 24 && i < data.hourly.time.length; i++) {
      const hour = new Date(data.hourly.time[i]).getHours().toString().padStart(2, '0') + ":00";
      labels.push(hour);
      temps.push(data.hourly.temperature_2m[i]);
      winds.push(knots(data.hourly.windspeed_10m[i]));
      rains.push(data.hourly.precipitation[i]);
    }

    // Destroy charts if they exist
    if (tempChart) tempChart.destroy();
    if (windChart) windChart.destroy();
    if (rainChart) rainChart.destroy();

    const tempCanvas = document.getElementById("tempChart");
    const windCanvas = document.getElementById("windChart");
    const rainCanvas = document.getElementById("rainChart");

    if(tempCanvas){
      tempChart = new Chart(tempCanvas, {
        type: "line",
        data: { labels, datasets: [{ label: "Temperatur (¬∞C)", data: temps, fill: true, tension: 0.3 }] }
      });
    }

    if(windCanvas){
      windChart = new Chart(windCanvas, {
        type: "line",
        data: { labels, datasets: [{ label: "Wind (Knoten)", data: winds, fill: true, tension: 0.3 }] }
      });
    }

    if(rainCanvas){
      rainChart = new Chart(rainCanvas, {
        type: "bar",
        data: { labels, datasets: [{ label: "Niederschlag (mm/h)", data: rains, backgroundColor: "rgba(54, 162, 235, 0.6)" }] },
        options: { responsive: true, scales: { y: { beginAtZero: true } } }
      });
    }

    const week = document.getElementById("weekly");
    if(week){
      week.innerHTML = "";
      for (let i = 0; i < data.daily.time.length; i++) {
        const day = new Date(data.daily.time[i]).toLocaleDateString('de-AT', { weekday: 'short', day: '2-digit', month: '2-digit' });
        const max = data.daily.temperature_2m_max[i];
        const min = data.daily.temperature_2m_min[i];
        const rise = data.daily.sunrise[i].split("T")[1];
        const set = data.daily.sunset[i].split("T")[1];
        const icon = max >= 25 ? "‚òÄÔ∏è" : max >= 15 ? "üå§Ô∏è" : max <= 0 ? "‚ùÑÔ∏è" : "‚õÖ";
        week.innerHTML += `
          <div class="day-card">
            <strong>${day}</strong><br>
            <div style="font-size:24px;">${icon}</div>
            üî∫ <span class="${max >= 20 ? 'temp-warm' : 'temp-cool'}">${max}¬∞C</span><br>
            üîª <span class="${min <= 5 ? 'temp-cool' : ''}">${min}¬∞C</span><br>
            üåÖ ${rise}<br>üåá ${set}
          </div>`;
      }
    }
  }

  // Header: local + UTC
  function zeigeDatumUhrzeit() {
    const jetzt = new Date();
    const datum = jetzt.toLocaleDateString("de-DE", { weekday:"long", year:"numeric", month:"long", day:"numeric" });
    const zeit = jetzt.toLocaleTimeString("de-DE", { hour:"2-digit", minute:"2-digit", second:"2-digit" });
    setTextIfExists("datetime", `${datum} ‚Äì ${zeit}`);
    setTextIfExists("utcNow",
      jetzt.toLocaleTimeString("en-GB", { timeZone: "UTC", hour: "2-digit", minute: "2-digit", second: "2-digit" })
    );
  }
  zeigeDatumUhrzeit();
  setInterval(zeigeDatumUhrzeit, 1000);

  // LOLU sunrise/sunset (coords)
  async function loadLoluSunTimes() {
    const lat = 47.918;
    const lon = 13.799;
    const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=sunrise,sunset&timezone=auto`;
    const res = await fetch(url);
    const data = await res.json();
    const sr = data?.daily?.sunrise?.[0];
    const ss = data?.daily?.sunset?.[0];
    const fmtHM = (iso) => iso ? iso.split("T")[1].slice(0,5) : "--:--";
    setTextIfExists("loluSunrise", fmtHM(sr));
    setTextIfExists("loluSunset",  fmtHM(ss));
  }

  // ===== Custom Ortssuche (Open-Meteo Geocoding) =====
  async function geocodePlace(q) {
    const url = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(q)}&count=5&language=de&format=json`;
    const res = await fetch(url);
    if (!res.ok) throw new Error("Geocoding fehlgeschlagen");
    const data = await res.json();
    return data?.results?.[0] || null;
  }

  async function searchPlace() {
    const input = document.getElementById("customPlace");
    const status = document.getElementById("placeStatus");
    const q = (input?.value || "").trim();

    if (!q) { if(status) status.textContent = "Bitte Ort eingeben."; return; }
    if(status) status.textContent = "Suche‚Ä¶";

    try {
      const r = await geocodePlace(q);
      if (!r) { if(status) status.textContent = "Nichts gefunden."; return; }

      const label = `${r.name}${r.admin1 ? ", " + r.admin1 : ""}${r.country ? " (" + r.country + ")" : ""}`;
      if(status) status.textContent = `Aktiv: ${label}`;

      window.__customCoords = { lat: r.latitude, lon: r.longitude };
      loadWeather(r.latitude, r.longitude);
    } catch (e) {
      if(status) status.textContent = "Fehler bei der Suche.";
    }
  }

  // Enter key triggers search (nur Wetter-Tab)
  document.addEventListener("DOMContentLoaded", () => {
    const input = document.getElementById("customPlace");
    if (input) {
      input.addEventListener("keydown", e => {
        if (e.key === "Enter") searchPlace();
      });
    }
  });

  // Start (Open-Meteo) + auto refresh
  loadWeather(DEFAULT_COORDS.lat, DEFAULT_COORDS.lon);
  setInterval(() => {
    const c = window.__customCoords || DEFAULT_COORDS;
    loadWeather(c.lat, c.lon);
  }, 10 * 60 * 1000);

  // Start (Sun times)
  loadLoluSunTimes();
  setInterval(loadLoluSunTimes, 6 * 60 * 60 * 1000);

  // =========================
  // METAR/TAF via Cloudflare Worker (dein Code unver√§ndert)
  // =========================
  const WX_PROXY = "https://orange-sky-8e02.juergen-sch85.workers.dev";

  async function loadWx(type, icao, mode) {
    const r = await fetch(`${WX_PROXY}?type=${encodeURIComponent(type)}&icao=${encodeURIComponent(icao)}&mode=${encodeURIComponent(mode)}`);
    if (!r.ok) throw new Error(await r.text());
    return r.json();
  }

  function extractRaw(json) {
    const d0 = json?.data?.[0];
    if (!d0) return "";
    if (typeof d0 === "string") return d0;
    return d0.raw_text || "";
  }

  function fmtWindText(m) {
    const w = m?.wind;
    if (!w) return { text: "‚Äî", spd: null, gst: null };
    const dir = w.direction || "VRB";
    const spd = w.speed?.kts ?? null;
    const gst = w.gust?.kts ?? null;
    const t = (spd == null) ? `${dir}` : (gst ? `${dir} ${spd}kt G${gst}` : `${dir} ${spd}kt`);
    return { text: t, spd, gst };
  }

  function fmtQnh(m) {
    if (m?.pressure?.hg) return `${Math.round(m.pressure.hg * 33.8639)} hPa`;
    return "‚Äî";
  }

  function fmtVis(m) {
    const v = m?.visibility;
    if (!v) return { text: "‚Äî", meters: null };
    const meters = (typeof v.meters === "number") ? v.meters : null;
    if (meters && meters !== 9999) return { text: `${meters} m`, meters };
    return { text: v.text || "‚Äî", meters };
  }

  function pickCeiling(m) {
    if (m?.ceiling?.feet) return { text: `${m.ceiling.code || ""} ${m.ceiling.feet} ft`.trim(), feet: m.ceiling.feet };
    const layer = (m?.clouds || []).find(x => ["BKN","OVC"].includes(x.code) && x.feet);
    return layer ? { text: `${layer.code} ${layer.feet} ft`, feet: layer.feet } : { text: "‚Äî", feet: null };
  }

  function fmtTempDp(m) {
    const t = m?.temperature?.celsius;
    const d = m?.dewpoint?.celsius;
    if (t == null && d == null) return "‚Äî";
    if (t != null && d != null) return `${t}¬∞C / ${d}¬∞C`;
    return `${t ?? "‚Äî"}¬∞C / ${d ?? "‚Äî"}¬∞C`;
  }

  function fmtWx(m) {
    const c = m?.conditions;
    if (Array.isArray(c) && c.length) return c.map(x => x.text || x.code).filter(Boolean).join(", ");
    return m?.wx_codes?.join?.(" ") || "‚Äî";
  }

  function setFlightCategory(cat) {
    const pill = document.getElementById("wxCatPill");
    const txt = document.getElementById("wxCatText");
    const panel = document.getElementById("wxPanel");

    if(!panel || !pill || !txt) return;

    panel.className = "wx-panel";
    if (!cat) { pill.style.display = "none"; return; }

    txt.textContent = cat;
    pill.className = "wx-pill " + cat.toLowerCase();
    pill.style.display = "inline-flex";

    panel.classList.add("cat-" + cat.toLowerCase());
  }

  function prettyTaf(raw) {
    if (!raw) return "";
    return raw.replace(/\\s(TEMPO|BECMG|INTER|FM\\d{6}|PROB\\d{2}|RMK)\\s/g, "\\n$1 ").trim();
  }

  function toggleRaw(id) {
    const el = document.getElementById(id);
    if(!el) return;
    el.style.maxHeight = el.style.maxHeight ? "" : "90px";
    el.style.overflow = el.style.overflow ? "" : "hidden";
  }

  async function copyText(id) {
    const t = document.getElementById(id)?.textContent || "";
    try { await navigator.clipboard.writeText(t); }
    catch {
      const ta = document.createElement("textarea");
      ta.value = t; document.body.appendChild(ta);
      ta.select(); document.execCommand("copy");
      document.body.removeChild(ta);
    }
  }

  function clearAlerts() {
    ["kvWind","kvVis","kvCeil","kvQnh","kvTemp","kvWx"].forEach(id => {
      const el = document.getElementById(id);
      if (el) el.classList.remove("warn","crit");
    });
  }

  function mark(elId, level) {
    const el = document.getElementById(elId);
    if (!el) return;
    el.classList.remove("warn","crit");
    if (level) el.classList.add(level);
  }

  function applyAlerts(m) {
    clearAlerts();

    const ceil = pickCeiling(m);
    if (ceil.feet != null) {
      if (ceil.feet < 800) mark("kvCeil", "crit");
      else if (ceil.feet < 1500) mark("kvCeil", "warn");
    }

    const w = fmtWindText(m);
    if (w.gst != null) {
      if (w.gst >= 35) mark("kvWind", "crit");
      else if (w.gst >= 25) mark("kvWind", "warn");
    } else if (w.spd != null) {
      if (w.spd >= 25) mark("kvWind", "crit");
      else if (w.spd >= 15) mark("kvWind", "warn");
    }

    const v = fmtVis(m);
    if (v.meters != null && v.meters !== 9999) {
      if (v.meters < 1500) mark("kvVis", "crit");
      else if (v.meters < 5000) mark("kvVis", "warn");
    }
  }

  async function updateMetarTafNative() {
    const sel = document.getElementById("metarSelect");
    if(!sel) return;

    const icao = sel.value;
    const hintEl = document.getElementById("wxHint");
    const tafNote = document.getElementById("wxTafNote");

    if(hintEl) hintEl.textContent = "";
    if(tafNote) tafNote.textContent = "";
    setTextIfExists("wxStation", icao);

    try {
      const metarJson = await loadWx("metar", icao, "decoded");
      const m = metarJson?.data?.[0];

      const tafJson = await loadWx("taf", icao, "raw");
      const tafText = extractRaw(tafJson);

      setTextIfExists("metarRaw", m?.raw_text || "(kein METAR)");
      setTextIfExists("tafRaw", tafText ? prettyTaf(tafText) : "(kein TAF)");

      setTextIfExists("wxObs", m?.observed ? m.observed.replace("T"," ").replace("Z","Z") : "‚Äî");
      setTextIfExists("wxStation", m?.station?.icao || icao);

      const wind = fmtWindText(m);
      const vis = fmtVis(m);
      const ceil = pickCeiling(m);

      setTextIfExists("wxWind", wind.text);
      setTextIfExists("wxVis", vis.text);
      setTextIfExists("wxCeil", ceil.text);
      setTextIfExists("wxQnh", fmtQnh(m));
      setTextIfExists("wxTempDp", fmtTempDp(m));
      setTextIfExists("wxWx", fmtWx(m));

      setFlightCategory(m?.flight_category);
      applyAlerts(m);

      if ((!m?.raw_text || !tafText) && hintEl) hintEl.textContent = "Hinweis: Wenn keine Reports verf√ºgbar sind, anderen Flugplatz w√§hlen.";
      if (tafText && tafNote) tafNote.textContent = "TAF ist umgebrochen (TEMPO/BECMG/PROB/FM ‚Ä¶).";

      const mr = document.getElementById("metarRaw");
      const tr = document.getElementById("tafRaw");
      if(mr){ mr.style.maxHeight = "90px"; mr.style.overflow = "hidden"; }
      if(tr){ tr.style.maxHeight = "180px"; tr.style.overflow = "hidden"; }
    } catch (e) {
      setFlightCategory(null);
      clearAlerts();
      setTextIfExists("wxObs","‚Äî");
      setTextIfExists("wxWind","‚Äî");
      setTextIfExists("wxVis","‚Äî");
      setTextIfExists("wxCeil","‚Äî");
      setTextIfExists("wxQnh","‚Äî");
      setTextIfExists("wxTempDp","‚Äî");
      setTextIfExists("wxWx","‚Äî");
      setTextIfExists("metarRaw","");
      setTextIfExists("tafRaw","");
      if(hintEl) hintEl.textContent = "Fehler beim Laden: " + String(e);
    }
  }

  document.getElementById("metarSelect")?.addEventListener("change", updateMetarTafNative);
  updateMetarTafNative();
  setInterval(updateMetarTafNative, 10 * 60 * 1000);

  // =========================
  // Webcam-Refresh (Panomax via WebcamGalore Snapshots)
  // =========================
  function refreshCamImg(id){
    const img = document.getElementById(id);
    if(!img) return;
    const base = img.getAttribute("data-base") || img.src.split("?")[0];
    img.setAttribute("data-base", base);
    const sep = base.includes("?") ? "&t=" : "?t=";
    img.src = base + sep + Date.now();
  }
  setInterval(() => {
    refreshCamImg("camSchafbergImg");
    refreshCamImg("camLichtenbergImg");
    refreshCamImg("camLOLS32");
    refreshCamImg("camLOLS14");
    refreshCamImg("camScharnstein");
    refreshCamImg("camLOLW");
    refreshCamImg("camTraunsteinFoto");
    refreshCamImg("camGruenberg");
  }, 60 * 1000);

</script>

</body>
</html>
